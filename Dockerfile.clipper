FROM golang:1.20 as builder

# Install Clipper
RUN go install github.com/wincent/clipper@latest

FROM ubuntu:latest

# Copy the Clipper binary from the builder stage
COPY --from=builder /go/bin/clipper /usr/local/bin/clipper

# Create start script
RUN echo '#!/bin/bash\n\
clipper --address 0.0.0.0 --port 8377 &\n\
exec "$@"' > /usr/local/bin/start-clipper.sh && \
    chmod +x /usr/local/bin/start-clipper.sh

ENTRYPOINT ["/usr/local/bin/start-clipper.sh"]
CMD ["/bin/bash"]
